<!-- Redeploy trigger: 2024-06-07-PROFESSIONAL -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>India Violence Tracker | Real-time Dashboard</title>
    <meta name="description" content="Professional monitoring and analysis of violence against Dalit, Bahujan, Adivasi, and minority communities in India">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="manifest" href="site.webmanifest">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" as="script">
    <link rel="preload" href="https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js" as="script">
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loader" class="loading-screen hidden">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading incident data...</p>
    </div>

    <!-- Error Banner -->
    <div id="errorBanner" class="error-banner hidden">
        <p>Error loading data. Please try refreshing the page.</p>
    </div>

    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="16" cy="16" r="16" fill="url(#gradient)"/>
                        <path d="M12 10h8v2h-8zm0 4h8v2h-8zm0 4h6v2h-6z" fill="white"/>
                        <defs>
                            <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#6366f1"/>
                                <stop offset="1" stop-color="#818cf8"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <h1 class="site-title">India Violence Tracker</h1>
                </div>
                <div class="header-actions">
                    <span id="last-updated" class="last-updated">Loading...</span>
                    <button id="refresh-btn" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 3a5 5 0 104.546 2.914.5.5 0 00-.908-.417A4 4 0 118 4v1.076L10.5 3.5l-.5-.5L8 5l-2-2zm-.5 4v3.5H6l2 2 2-2H8.5V7H7.5z"/>
                        </svg>
                        Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-incidents">--</div>
                    <div class="stat-label">Total Incidents</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="this-week">--</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="this-month">--</div>
                    <div class="stat-label">This Month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="top-state">--</div>
                    <div class="stat-label">Most Affected State</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters Section -->
    <section class="filters-section">
        <div class="container">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="date-from" class="filter-label">From Date</label>
                    <input type="date" id="date-from" class="filter-input">
                </div>
                <div class="filter-group">
                    <label for="date-to" class="filter-label">To Date</label>
                    <input type="date" id="date-to" class="filter-input">
                </div>
                <div class="filter-group">
                    <label for="state-filter" class="filter-label">State</label>
                    <select id="state-filter" class="filter-select">
                        <option value="">All States</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="victim-group-filter" class="filter-label">Victim Group</label>
                    <select id="victim-group-filter" class="filter-select">
                        <option value="">All Groups</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="incident-type-filter" class="filter-label">Incident Type</label>
                    <select id="incident-type-filter" class="filter-select">
                        <option value="">All Types</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button id="clear-filters" class="btn btn-secondary" style="margin-top: 24px;">
                        Clear Filters
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Loading State -->
            <div id="loading-screen" class="loading-screen">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading incident data...</p>
            </div>

            <!-- Error State -->
            <div id="error-screen" class="error-screen hidden">
                <div class="error-icon">⚠️</div>
                <h2>Failed to Load Data</h2>
                <p>Unable to fetch incident data. Please try again later.</p>
                <button id="retry-btn" class="btn btn-primary">Retry</button>
            </div>

            <!-- Main Dashboard -->
            <div id="dashboard" class="content-grid hidden">
                <!-- Map Section -->
                <section class="card map-section">
                    <div class="section-header">
                        <h2 class="section-title">Incident Map</h2>
                        <p class="section-subtitle">Geographic distribution of reported incidents</p>
                    </div>
                    <div class="map-container">
                        <div id="map"></div>
                    </div>
                </section>

                <!-- Charts Section -->
                <div class="charts-grid">
                    <section class="card">
                        <div class="section-header">
                            <h3 class="section-title">Incidents by Type</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="incidentTypeChart"></canvas>
                        </div>
                    </section>

                    <section class="card">
                        <div class="section-header">
                            <h3 class="section-title">Affected Communities</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="victimGroupChart"></canvas>
                        </div>
                    </section>

                    <section class="card">
                        <div class="section-header">
                            <h3 class="section-title">State Distribution</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="stateChart"></canvas>
                        </div>
                    </section>
                </div>

                <!-- Data Table Section -->
                <section class="card table-section">
                    <div class="table-header">
                        <div>
                            <h2 class="section-title">Recent Incidents</h2>
                            <p class="section-subtitle">Detailed view of reported incidents</p>
                        </div>
                        <div class="table-controls">
                            <input type="text" id="search-input" placeholder="Search incidents..." class="search-input">
                            <select id="sort-select" class="filter-select">
                                <option value="incident_date">Sort by Date</option>
                                <option value="state">Sort by State</option>
                                <option value="incident_type">Sort by Type</option>
                                <option value="victim_group">Sort by Victim Group</option>
                                <option value="confidence_score">Sort by Confidence</option>
                            </select>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table" id="incidents-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Date</th>
                                    <th>Title</th>
                                    <th>Location</th>
                                    <th>Type</th>
                                    <th>Source</th>
                                </tr>
                            </thead>
                            <tbody id="incidentsTableBody">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="table-footer">
                        <div>
                            <span style="font-size: var(--text-sm); color: var(--color-text-muted);">
                                Showing <span id="showing-count">0</span> of <span id="total-count">0</span> incidents
                            </span>
                        </div>
                        <div style="display: flex; gap: var(--space-sm); align-items: center;">
                            <button id="fix-coordinates-btn" class="btn btn-secondary">Fix Coordinates</button>
                            <button id="prev-page" class="btn btn-secondary">Previous</button>
                            <span id="page-info" style="font-size: var(--text-sm); color: var(--color-text-muted);">Page 1</span>
                            <button id="next-page" class="btn btn-secondary">Next</button>
                        </div>
                    </div>
                    <div id="paginationControls"></div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>About This Project</h3>
                    <p>
                        Professional monitoring and analysis of violence and discrimination against Dalit, Bahujan, Adivasi, 
                        and minority communities in India. Data sourced from verified news reports and official sources.
                    </p>
                </div>
                <div class="footer-section">
                    <h3>Data Sources</h3>
                    <ul>
                        <li>• Major Indian news outlets</li>
                        <li>• RSS feeds and APIs</li>
                        <li>• Manual verification process</li>
                        <li>• Community reports</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Important Note</h3>
                    <p>
                        This data represents reported incidents only. Many cases go unreported. 
                        This tracker aims to raise awareness and promote justice through data transparency.
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 India Violence Tracker. Open source project for social justice.</p>
                <p>Last updated: <span id="footer-last-updated">--</span></p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Debug script - helps diagnose map issues -->
    <script src="js/debug.js?v=3"></script>
    
    <!-- App modules -->
    <script type="module" src="js/data.js?v=3"></script>
    <script type="module" src="js/map.js?v=3"></script>
    <script type="module" src="js/charts.js?v=3"></script>
    <script type="module" src="js/table.js?v=3"></script>
    <script type="module" src="js/app.js?v=3"></script>
    
    <!-- Debug adapter - makes modules available for debugging -->
    <script type="module" src="js/debug-adapter.js?v=3"></script>
</body>
</html>
